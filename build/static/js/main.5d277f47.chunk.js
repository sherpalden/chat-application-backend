(this["webpackJsonpdropdown-tree"]=this["webpackJsonpdropdown-tree"]||[]).push([[0],{122:function(e,t,n){"use strict";n.r(t);var s=n(1),c=n(0),r=n.n(c),a=n(26),o=n.n(a),i=(n(69),n(70),n(4)),l=n(17),u=n(62),d=n(2),j="GOOGLE_LOGIN_REQUEST",O="GOOGLE_LOGIN_SUCCESS",b="GOOGLE_LOGIN_FAILURE",g="GOOGLE_SIGNUP_REQUEST",v="GOOGLE_SIGNUP_SUCCESS",p="GOOGLE_SIGNUP_FAILURE",f={login:{state:"",loading:!1,error:null},signup:{state:"",loading:!1,error:null,message:null}},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case j:return Object(d.a)(Object(d.a)({},e),{},{login:Object(d.a)(Object(d.a)({},e.login),{},{state:"",loading:!0,error:null})});case O:return Object(d.a)(Object(d.a)({},e),{},{login:Object(d.a)(Object(d.a)({},e.login),{},{state:"success",loading:!1})});case b:return Object(d.a)(Object(d.a)({},e),{},{login:Object(d.a)(Object(d.a)({},e.login),{},{state:"failed",loading:!1,error:n})});case g:return Object(d.a)(Object(d.a)({},e),{},{login:Object(d.a)(Object(d.a)({},e.login),{},{state:"",loading:!0,error:null,message:null})});case v:return Object(d.a)(Object(d.a)({},e),{},{login:Object(d.a)(Object(d.a)({},e.login),{},{state:"success",loading:!1,message:n})});case p:return Object(d.a)(Object(d.a)({},e),{},{login:Object(d.a)(Object(d.a)({},e.login),{},{state:"failed",loading:!1,error:n,message:null})});default:return e}},h="LOAD_USERS_SUCCESS",x="LOAD_DIRECT_CONVERSATIONS_SUCCESS",N="UPDATE_CURRENT_CONVERSATION",y="UPDATE_CURRENT_DIRECT_CONVERSATION_MESSAGES",S={users:[],groups:[],conversations:{directConversations:[],groupConversations:[]},currentConversation:{type:"",conversationID:""},homeSocket:{}},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h:return Object(d.a)(Object(d.a)({},e),{},{users:t.payload});case x:return Object(d.a)(Object(d.a)({},e),{},{conversations:Object(d.a)(Object(d.a)({},e.conversations),{},{directConversations:t.payload})});case N:return Object(d.a)(Object(d.a)({},e),{},{currentConversation:t.payload});case y:var n=e.conversations.directConversations.map((function(e){return e._id===t.payload.conversationID&&e.messages.unshift(t.payload.message),e}));return Object(d.a)(Object(d.a)({},e),{},{conversations:Object(d.a)(Object(d.a)({},e.conversations),{},{directConversations:n})});default:return e}},E=Object(l.c)({auth:m,messaging:C}),U=[u.a],_=l.d,I=Object(l.e)(E,{},_(l.a.apply(void 0,U))),w=n(5),D=n(7),G=Object(D.a)();var P=function(e){return Object(s.jsx)(c.Fragment,{children:Object(s.jsx)("main",{children:e.children})})},T=function(e){return function(t){t({type:h,payload:e})}},k=function(e){return function(t){t({type:x,payload:e})}},R=function(e,t){return function(n){n({type:N,payload:{type:e,conversationID:t}})}},L=function(e,t){return function(n){n({type:y,payload:{type:"dm",conversationID:e,message:t}})}};var A=function(e){var t=Object(i.b)(),n=Object(i.c)((function(e){return e.messaging}));return n.currentConversation,n.conversation,Object(s.jsx)("div",{children:Object(s.jsxs)("div",{className:"direct-user-container",id:e.conv._id,onClick:function(e){e.preventDefault();for(var n=e.target;"direct-user-container"!==n.className;)n=n.parentNode;t(R("dm",n.id))},children:[Object(s.jsx)("div",{className:"user-profile-img",children:Object(s.jsx)("img",{src:e.conv.oppUser.profilePic,alt:"User Profile Picture",width:"25",height:"27"})}),Object(s.jsxs)("div",{className:"username",children:[e.conv.oppUser.firstName," ",e.conv.oppUser.lastName]})]})})};var F=function(){var e=Object(i.c)((function(e){return e.messaging.conversations})).directConversations;return Object(s.jsx)("div",{children:Object(s.jsx)("div",{className:"conversations-list",children:e.map((function(e){if(e)return Object(s.jsx)(A,{conv:e},e._id)}))})})};var M=function(e){return Object(s.jsx)("div",{children:"Group Conversations"})},q=n(16);var H=function(e){return Object(s.jsx)("div",{children:Object(s.jsxs)("div",{className:"message-header",children:[Object(s.jsx)("div",{className:"user-profile-img",children:Object(s.jsx)("img",{src:e.oppUser.profilePic,alt:"User Profile Picture",width:"25",height:"27"})}),Object(s.jsxs)("div",{className:"username",children:[e.oppUser.firstName," ",e.oppUser.lastName]})]})})};var V=function(){var e=Object(i.b)(),t=Object(c.useState)(""),n=Object(q.a)(t,2),r=n[0],a=n[1],o=Object(i.c)((function(e){return e.messaging})).currentConversation;return Object(s.jsx)("div",{children:Object(s.jsxs)("form",{className:"message-footer",onSubmit:function(t){t.preventDefault(),0!=r.length&&z.emit("sendDM",{conversationID:o.conversationID,text:r},(function(t,n){t?console.log(t):(console.log(n),e(L(n.message.conversationID,n.message)))}))},children:[Object(s.jsx)("textarea",{className:"message-input",onChange:function(e){a(e.target.value),e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"},placeholder:"Type your message.."}),Object(s.jsx)("button",{type:"submit",children:" SEND "})]})})};var B=function(e){var t=e.messageData,n=t.oppUser,c=t.message;return Object(s.jsxs)("div",{children:[n._id===c.senderID&&Object(s.jsxs)("div",{className:"message-wrapper-left",children:[Object(s.jsx)("div",{className:"profile-img",style:{margin:"5px",padding:"2px"},children:Object(s.jsx)("img",{src:n.profilePic,alt:"User Profile Picture",width:"25",height:"27"})}),c.text&&Object(s.jsx)("div",{className:"message-container",children:c.text})]}),n._id!==c.senderID&&Object(s.jsx)("div",{className:"message-wrapper-right",children:c.text&&Object(s.jsx)("p",{className:"message-container",style:{backgroundColor:"lightblue"},children:c.text})})]})};var J=function(e){var t=e.conversation,n=t.oppUser,r=t.messages,a=Object(c.useRef)(null);return Object(c.useEffect)((function(){a.current.scrollTop=2e3}),[]),Object(s.jsx)("div",{children:Object(s.jsx)("div",{className:"scrollbar",id:"style-6",ref:a,children:Object(s.jsx)("div",{className:"force-overflow message-list",children:r.map((function(e){return Object(s.jsx)(B,{messageData:{oppUser:n,message:e}},e._id)}))})})})};var Q=function(){Object(i.b)();var e=Object(i.c)((function(e){return e.messaging})),t=e.currentConversation,n=e.conversations,r=Object(c.useState)(n.directConversations[0]),a=Object(q.a)(r,2),o=a[0],l=a[1];return function(e,t){var n=Object(c.useRef)(!1);Object(c.useEffect)((function(){n.current?e():n.current=!0}),t)}((function(){var e=function(e,t){return"dm"===e.type?t.directConversations.filter((function(t){return e.conversationID===t._id}))[0]:t.groupConversations.filter((function(t){return e.conversationID===t._id}))[0]}(t,n);l(e)}),[t]),Object(s.jsx)("div",{children:n.directConversations.length>0&&Object(s.jsxs)("div",{className:"message-body",children:[Object(s.jsx)(H,{oppUser:o.oppUser}),Object(s.jsx)(J,{conversation:o}),Object(s.jsx)(V,{})]})})};var W=function(e){return Object(s.jsx)("div",{children:Object(s.jsxs)("div",{className:"direct-user-container",id:e.user._id,onClick:function(e){e.preventDefault();for(var t=e.target;"direct-user-container"!==t.className;)t=t.parentNode;alert("Say Hello")},children:[Object(s.jsx)("div",{className:"user-profile-img",children:Object(s.jsx)("img",{src:e.user.profilePic,alt:"User Profile Picture",width:"25",height:"27"})}),Object(s.jsxs)("div",{className:"username",children:[e.user.firstName," ",e.user.lastName]})]})})};var z,Y=function(){var e=Object(i.b)(),t=Object(i.c)((function(e){return e.messaging})),n=t.users,r=t.conversations;return Object(c.useEffect)((function(){z.emit("loadUsers",(function(t,n){t?console.log(t):e(T(n.users))})),z.on("newDM",(function(t){e(L(t.message.conversationID,t.message))}))}),[]),Object(c.useEffect)((function(){z.emit("loadDirectConversations",{skip:0,limit:5},(function(t,n){t?console.log(t):(e(k(n.directConversations)),e(R("dm",n.directConversations[0]._id)))}))}),[]),Object(s.jsx)("div",{children:Object(s.jsxs)("div",{className:"messaging-page-body",children:[Object(s.jsxs)("div",{className:"conversation-body",children:[Object(s.jsx)(F,{}),Object(s.jsx)(M,{})]}),r.directConversations.length>0&&Object(s.jsx)("div",{className:"message-body",children:Object(s.jsx)(Q,{})}),Object(s.jsx)("div",{className:"contacts-body",children:Object(s.jsx)("div",{className:"conversations-list",children:n.map((function(e){return Object(s.jsx)(W,{user:e},e._id)}))})})]})})},K="http://localhost:5000",X=n(63);function Z(){Object(i.b)();var e=localStorage.getItem("accessToken");return z=Object(X.io)(K,{auth:{token:e}}),Object(s.jsx)(P,{children:Object(s.jsx)(Y,{})})}var $=n(34);var ee=function(){return Object(s.jsx)("header",{children:Object(s.jsx)("div",{className:"top-header",children:Object(s.jsx)("div",{className:"container",children:Object(s.jsxs)("div",{className:"row",children:[Object(s.jsx)("div",{className:"col-12 col-sm-12 col-md-6 col-lg-6",children:Object(s.jsxs)($.a,{to:"/",children:[Object(s.jsx)("h5",{children:"Alternative Platform"}),Object(s.jsx)("p",{children:"Global Humanity Initiative"})]})}),Object(s.jsx)("div",{className:"col-12 col-sm-12 col-md-6 col-lg-6"})]})})})})};var te=function(e){return Object(s.jsxs)(c.Fragment,{children:[Object(s.jsx)(ee,{}),Object(s.jsx)("main",{children:e.children})]})},ne=n(18),se=n.n(ne);se.a.interceptors.response.use((function(e){return console.log(e),Promise.resolve(e)}),(function(e){return e.response&&e.response.status>=400&&e.response.status<500&&(500===e.response.status&&alert("Server is not responding, please try again later."),401===e.response.status?(e.response.data?alert("Unauthorized"):alert("Your session has expired, please login again."),localStorage.getItem("accessToken")&&(localStorage.clear(),window.location.href="/")):e.response.data.result&&e.response.data.result.message?alert(e.response.data.result.message):console.log("Bad request"),console.log(e.response)),Promise.reject(e)}));var ce={get:se.a.get,post:se.a.post,put:se.a.put,delete:se.a.delete,patch:se.a.patch},re=function(e){return ce.post("".concat(K,"/api/user/login/google"),{authCode:e})},ae=function(e){return ce.post("".concat(K,"/api/user/signUp/google"),{authCode:e})},oe=function(e){return function(t){t({type:j}),re(e).then((function(e){var n=e.data.accessToken;localStorage.setItem("accessToken",n),t({type:O}),window.location.reload()})).catch((function(e){var n=e.response.data.error;t({type:b,payload:n})}))}},ie=function(e){return function(t){t({type:g}),ae(e).then((function(e){var n=e.data.accessToken;localStorage.setItem("accessToken",n),t({type:v,payload:n}),window.location.reload()})).catch((function(e){t({type:p,payload:"!Error"})}))}};function le(){var e=Object(c.useState)({}),t=Object(q.a)(e,2),n=t[0],r=t[1],a=Object(i.b)();Object(c.useEffect)((function(){window.gapi.load("auth2",(function(){var e=window.gapi.auth2.init({client_id:"352936315579-n8j9c0qe63m677g9fjt178821n0v4a0f.apps.googleusercontent.com"});r(e)}))}),[]);return Object(s.jsx)("div",{children:Object(s.jsx)("button",{className:"googleLogin",onClick:function(e){e.preventDefault(),n.grantOfflineAccess().then((function(e){e.code||console.log("Error occurred"),a(oe(e.code))})).catch((function(e){console.log(e)}))},children:"Login With Google"})})}function ue(){var e=Object(c.useState)({}),t=Object(q.a)(e,2),n=t[0],r=t[1],a=Object(i.b)();Object(c.useEffect)((function(){window.gapi.load("auth2",(function(){var e=window.gapi.auth2.init({client_id:"352936315579-n8j9c0qe63m677g9fjt178821n0v4a0f.apps.googleusercontent.com"});r(e)}))}),[]);return Object(s.jsx)("div",{children:Object(s.jsx)("button",{className:"googleSignUp",onClick:function(e){e.preventDefault(),n.grantOfflineAccess().then((function(e){e.code||console.log("Error occurred"),a(ie(e.code))})).catch((function(e){console.log(e)}))},children:"Sign Up With Google"})})}var de=function(){return Object(s.jsx)("div",{children:Object(s.jsxs)(te,{children:[Object(s.jsx)(le,{}),Object(s.jsx)(ue,{})]})})};var je=function(){var e=localStorage.getItem("accessToken")?Object(s.jsx)(Z,{}):Object(s.jsx)(de,{});return Object(s.jsx)(i.a,{store:I,children:Object(s.jsx)(w.a,{history:G,children:e})})};o.a.render(Object(s.jsx)(r.a.StrictMode,{children:Object(s.jsx)(je,{})}),document.getElementById("root"))},69:function(e,t,n){},70:function(e,t,n){}},[[122,1,2]]]);
//# sourceMappingURL=main.5d277f47.chunk.js.map